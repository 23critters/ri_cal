Autotest.add_hook :initialize do |at|
  %w{.svn .hg .git .bzr}.each { |exception| at.add_exception(exception) }
  at.clear_mappings
  

  at.add_mapping(%r%^(spec/(spec_helper|lib/.*)|config/(boot|environment(s/test)?))\.rb$%) { |f,m|
    [f]
  }
  at.add_mapping(%r%^lib/(.*)\.rb$%) { |_, m|
    puts "match is spec/lib/#{m[1]}_spec.rb"
    ["spec/lib/#{m[1]}_spec.rb"]
  }

end

Autotest.add_discovery do
  "rspec" # if File.directory?('spec') && ENV['RSPEC']
end

class Autotest::Rspec

  # def make_test_cmd(files_to_test)
  #   return '' if files_to_test.empty?
  #   return "spec #{files_to_test.keys.flatten.join(' ')} #{add_options_if_present}"
  # end
  # 
  def make_test_cmd(files_to_test)
      return '' if files_to_test.empty?
      puts "/opt/local/bin/spec #{files_to_test.keys.flatten.join(' ')} #{add_options_if_present}"
      
      return "/opt/local/bin/spec #{files_to_test.keys.flatten.join(' ')} #{add_options_if_present}"
    end
end


require 'autotest/menu'
begin
  if RUBY_PLATFORM =~ /mswin|mingw/
    require 'autotest/snarl'
    require 'Win32/Console/ANSI'
  else
    require 'autotest/growl'
  end
rescue LoadError => e
  puts "I suggest you install Growl or Snarl for cool notifications!"
  puts "(don't forget about win32console under Windows to get nice color output)"
end         